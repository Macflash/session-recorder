(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{10:function(e,t,n){e.exports=n(18)},16:function(e,t,n){},17:function(e,t,n){},18:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),r=n(8),o=n.n(r),s=(n(16),n(1)),c=n(2),l=n(4),u=n(3),d=n(5),h=(n(17),n(9)),p=function(e,t,n){var a=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return a?new Promise(function(t,n){a.call(navigator,e,t,n)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))},m=function(){void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=p)},f=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props,t=e.onClick,n=e.title,a=e.direction,r=e.disabled,o=e.size,s=void 0===o?"75px":o,c="calc(.5 * "+s+")",l="calc(.8 *"+s+")",u=r?"rgb(50,50,50)":"rgb(125,125,125)",d=r||!t;return i.a.createElement("button",{disabled:d,onClick:t,title:n,style:{padding:0,height:0,width:0,backgroundColor:"transparent",borderTop:c+" solid transparent",borderBottom:c+" solid transparent",borderLeft:"right"==a?l+" solid "+u:"none",borderRight:"left"==a?l+" solid "+u:"none",cursor:d?void 0:"pointer"}})}}]),t}(a.PureComponent),v=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props,t=e.onClick,n=e.title,a=e.disabled,r=e.size,o=void 0===r?"75px":r,s=a?"rgb(125,0,0)":"rgb(225,0,0)",c=a||!t;return i.a.createElement("button",{onClick:t,title:n,disabled:c,style:{height:o,width:o,borderRadius:o,backgroundColor:s,border:"none",cursor:c?"unset":"pointer"}})}}]),t}(a.PureComponent),g=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props.size||"75px";return i.a.createElement("button",{onClick:this.props.onClick,title:this.props.title,style:{height:e,width:e,backgroundColor:"rgb(125,125,125)",border:"none",cursor:"pointer"}})}}]),t}(a.PureComponent),b=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{style:{flex:"none",display:"flex",flexDirection:this.props.direction||"row",textAlign:"center",justifyContent:"space-around",alignItems:"center",padding:"5px"}},this.props.children)}}]),t}(a.Component),y=n(6),C=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{style:Object(y.a)({padding:"10% 15px",display:"flex",alignItems:"center"},this.props.style)},this.props.children)}}]),t}(a.Component),k=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement("div",{style:{MsUserSelect:"none",MozUserSelect:"none",userSelect:"none",position:"absolute",top:"2.5%",bottom:"5%",left:"5%",right:"5%",display:"flex",flexDirection:"column",justifyContent:"flex-end"}},this.props.children)}}]),t}(a.Component),w=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement("button",{className:"close",onClick:this.props.onClick,title:this.props.title,style:{height:this.props.size,width:this.props.size||"75px",backgroundColor:"transparent",border:"none",cursor:"pointer"}})}}]),t}(a.PureComponent),j=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,n=this.props,a=n.title,r=n.screen,o=n.icon,s=n.onStopAudio;return i.a.createElement("div",{style:{justifyContent:"space-between",alignItems:"center",paddingBottom:"5%",marginBottom:"auto",display:"flex",fontSize:"125%"}},t.renderIcon(o),"start"==r?i.a.createElement("a",{style:{margin:"0 10px",marginRight:"auto"},href:"https://github.com/macflash/session-recorder"},a):i.a.createElement("span",{style:{margin:"0 10px",marginRight:"auto"}},a),"listen"==r&&i.a.createElement("button",{style:{marginLeft:"auto"},onClick:function(){e.props.onScreenChange("record")}},"Record"),s&&i.a.createElement(w,{size:"25px",title:"Stop audio",onClick:s}))}}],[{key:"renderIcon",value:function(e){switch(e){case"recording":return i.a.createElement(v,{size:"20px"});default:return i.a.createElement(v,{size:"20px",disabled:!0})}}}]),t}(a.Component),O=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement(k,null,i.a.createElement(j,this.props),this.props.children)}}]),t}(a.Component),S=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(i)))).clipCanvas=null,n.lastProgress=0,n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"redrawCanvas",value:function(e){if(this.lastProgress=e,this.clipCanvas){var t=this.clipCanvas.getContext("2d"),n=this.clipCanvas.width,a=this.clipCanvas.height;t.fillStyle="rgb(25, 25, 25)",t.fillRect(0,0,n,a),t.lineWidth=2,t.strokeStyle="rgb(225, 225, 225)";var i=1*n/this.props.waveform.length,r=0;t.beginPath(),t.moveTo(0,a/2);for(var o=e*this.props.waveform.length,s=!0,c=0;c<this.props.waveform.length;c++){var l=this.props.waveform[c]/128*a/2;t.lineTo(r,l),c>=o&&s&&(t.stroke(),t.beginPath(),t.moveTo(r,l),t.strokeStyle="rgb(125, 125, 125)",s=!1),r+=i}t.stroke()}}},{key:"componentDidUpdate",value:function(){this.redrawCanvas(this.lastProgress)}},{key:"render",value:function(){var e=this;return i.a.createElement("canvas",{height:"100",width:"1000",style:Object(y.a)({flex:"auto"},this.props.style),ref:function(t){!e.clipCanvas&&t&&(e.clipCanvas=t,e.clipCanvas.onclick=function(n){if(e.props.onSeek){var a=n.offsetX/t.clientWidth;e.props.onSeek(a)}},e.setState({clipCanvas:t}))}})}}]),t}(a.Component),x=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(i)))).Visual=null,n.Audio=null,n.clipCanvas=null,n.download=function(){var e=n.props.clipInfo,t=document.createElement("a");t.href=e.audioUrl,t.download=(e.sessionName?e.sessionName+"_":"")+e.trackName+".webm",document.body.appendChild(t),n.download&&t.click(),document.body.removeChild(t)},n.onTimeUpdate=function(e){n.Audio&&n.Visual&&n.Visual.redrawCanvas(n.getCurrentTime()/n.getTotalTime())},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"getTotalTime",value:function(){return this.Audio.duration}},{key:"getCurrentTime",value:function(){return this.Audio.currentTime}},{key:"setCurrentTime",value:function(e){this.Audio.currentTime=e}},{key:"render",value:function(){var e=this,t=this.props,n=t.clipInfo,a=t.showAudio,r=t.onDelete,o=t.onRename,s=t.onAudioPlayed,c=t.audioRef;return i.a.createElement("div",{style:{display:"flex",flexDirection:"row",height:"100px",margin:"5px 0",justifyContent:"space-between",alignItems:"center"}},i.a.createElement("div",{style:{flex:"none",display:"flex",alignItems:"center",marginRight:"5px"}},n.trackNumber),i.a.createElement("div",{style:{maxWidth:"33%",margin:"0 5px",justifyContent:"space-around",flex:"none",display:"flex",flexDirection:"column",height:"100%"}},i.a.createElement("div",{style:{flex:"none",textOverflow:"ellipsis",overflow:"hidden"}},n.trackName),i.a.createElement("button",{onClick:o},"Rename"),i.a.createElement("button",{onClick:this.download},"Download")),i.a.createElement("div",{style:{flex:"auto",display:"flex",flexDirection:"column",maxWidth:"80%",minWidth:"50%",margin:"0 5px"}},i.a.createElement(S,{onSeek:function(t){var n=t*e.getTotalTime();e.setCurrentTime(n)},ref:function(t){e.Visual=e.Visual||t},waveform:n.waveform,style:{height:"50px"}}),i.a.createElement("audio",{ref:function(t){t&&(t.onplay=function(){e.setState({status:"playing"})},t.ontimeupdate=e.onTimeUpdate),t&&c&&c(t),e.Audio=e.Audio||t},onPlay:s,controls:a,style:{width:"100%",height:"40px",marginTop:"10px"},src:n.audioUrl})),i.a.createElement(w,{size:"50px",title:"Delete",onClick:r}))}}]),t}(a.Component),E=function(e){function t(){var e,n;Object(s.a)(this,t);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(i)))).audioElements=[],n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"stopAllClips",value:function(e){this.audioElements.forEach(function(t,n){e!=n&&t.pause()})}},{key:"render",value:function(){var e=this,t=this.props,n=t.clips,a=t.onClipPlayed,r=t.onDelete,o=t.onRename;return i.a.createElement("div",{style:{overflow:"auto",flex:"auto",padding:"5px"}},n.map(function(t,n){return i.a.createElement(x,{showAudio:!0,audioRef:function(t){t&&(e.audioElements[n]=t)},key:n,clipInfo:t,onRename:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){o(n)}),onDelete:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){r(n)}),onAudioPlayed:function(){e.stopAllClips(n),a&&a()}})}))}}]),t}(a.Component),N=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).mediaRecorder=void 0,n.analyser=void 0,n.dataBuffer=void 0,n.maxSilence=100,n.minSaveLength=1e3,n.lastClip=void 0,n.saveMode="autodecide",n.lastNoiseCounter=0,n.chunks=[],n.waveform=[],n.trackCount=1,n.stream=void 0,n.saveClip=function(e){e.trackName="Track "+n.trackCount,e.trackNumber=n.trackCount,n.trackCount++,n.setState({clips:[].concat(Object(h.a)(n.state.clips),[e]),lastClip:void 0}),n.lastClip=void 0,n.waveform=[]},n.record=function(){if(!n.mediaRecorder)throw"No recorder!";n.mediaRecorder.start(),n.setState({status:"recording"})},n.split=function(){if(!n.mediaRecorder)throw"No recorder!";n.mediaRecorder.stop(),n.setState({status:"armed"})},n.stop=function(){if(!n.mediaRecorder)throw"No recorder!";"recording"!=n.mediaRecorder.state&&"paused"!=n.mediaRecorder.state||n.mediaRecorder.stop(),n.setState({status:"ready"})},n.stopAudio=function(){n.props.onScreenChange("start")},m(),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:!0}).then(function(e){n.initializeAudioStream(e);var t=document.querySelector(".visualizer"),a=t.getContext("2d");a.fillStyle="rgb(25, 25, 25)",a.lineWidth=2;!function e(){setTimeout(e,1e3/60),n.readAnalyserData();var i=t.width,r=t.height;a.fillRect(0,0,i,r),"recording"==n.state.status?a.strokeStyle="rgb(225, 0, 0)":a.strokeStyle="rgb(75, 75, 75)";var o=1*i/n.waveform.length,s=0;a.beginPath(),a.moveTo(0,r/2);for(var c=0;c<n.waveform.length;c++){var l=n.waveform[c]/128*r/2;a.lineTo(s,l),s+=o}a.lineTo(t.width,t.height/2),a.stroke()}(),n.setState({status:"armed"})}).catch(function(e){alert("The following getUserMedia error occured: "+e),n.setState({status:"error"})}):(alert("getUserMedia not supported on your browser!"),n.setState({status:"error"})),n.state={status:"initializing",clips:[]},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){}},{key:"componentWillUnmount",value:function(){this.stream&&this.stream.getTracks().forEach(function(e){return e.stop()})}},{key:"initializeAudioStream",value:function(e){var t=this;this.stream=e,this.setState({stream:e});var n=new AudioContext,a=n.createMediaStreamSource(e);this.analyser=n.createAnalyser(),a.connect(this.analyser);var i=this.analyser.fftSize;this.dataBuffer=new Uint8Array(i),this.mediaRecorder=new MediaRecorder(e,{mimeType:"audio/webm",audioBitsPerSecond:32e4}),this.mediaRecorder.onstart=function(e){t.chunks=[],t.waveform=[]},this.mediaRecorder.ondataavailable=function(e){t.chunks.push(e.data),t.readAnalyserData()},this.mediaRecorder.onstop=function(e){var n=new Blob(t.chunks,{type:"audio/webm"}),a={audioUrl:window.URL.createObjectURL(n),waveform:t.waveform,sessionName:t.props.title};if(t.chunks=[],t.waveform=[],t.lastClip=a,t.setState({lastClip:a}),"autodecide"==t.saveMode&&a.waveform.length<t.minSaveLength)console.log("skip saving the track since it is so short");else{if("skipNext"==t.saveMode)return t.saveMode="autodecide",void console.log("skip saving because we are in skipNext save mode");"saveNext"==t.saveMode&&(t.saveMode="autodecide",console.log("force saving because we are in saveNext save mode")),t.saveClip(a)}}}},{key:"readAnalyserData",value:function(){if(!this.analyser||!this.dataBuffer)throw"missing analyser node or data buffer!";this.analyser.getByteTimeDomainData(this.dataBuffer);var e=1e14,t=-1e14;this.dataBuffer.forEach(function(n){e=Math.min(n,e),t=Math.max(n,t)}),this.waveform=this.waveform.concat([e,t]),"recording"!=this.state.status&&this.waveform.length>this.maxSilence&&this.waveform.length<this.maxSilence+10&&(this.waveform=this.waveform.slice(this.waveform.length-this.maxSilence)),this.autoStartStop(e,t)}},{key:"autoStartStop",value:function(e,t){t>140||e<100?(this.lastNoiseCounter=0,"armed"==this.state.status&&this.record()):(this.lastNoiseCounter++,this.lastNoiseCounter>this.maxSilence&&"recording"==this.state.status&&this.split())}},{key:"renderMainButton",value:function(){var e=this,t=this.state.status;switch(t){case"ready":return i.a.createElement(v,{onClick:function(){e.setState({status:"armed"})},title:"Arm for recording"});case"armed":case"recording":return i.a.createElement(g,{onClick:this.stop,title:"Stop"});default:return i.a.createElement("div",{style:{height:"75px",color:"rgb(50,50,50)",display:"flex",alignItems:"center",textAlign:"center"}},t)}}},{key:"render",value:function(){var e=this,t=this.state,n=t.status,a=t.clips,r=t.lastClip,o=t.stream?this.stopAudio:void 0;return i.a.createElement(O,{screen:"record",icon:n,title:"Recording "+(this.props.title||""),onScreenChange:this.props.onScreenChange,onStopAudio:o},i.a.createElement(E,{clips:a,onClipPlayed:this.stop,onDelete:function(t){a.splice(t,1);e.setState({clips:a.slice()})},onRename:function(t){var n=JSON.parse(JSON.stringify(a[t]));n.trackName=prompt("Rename '"+n.trackName+"'")||n.trackName,a[t]=n,e.setState({clips:a.slice()})}}),i.a.createElement(C,null,i.a.createElement("canvas",{className:"visualizer",height:"100",width:"1000",style:{width:"100%",height:"100px"}})),i.a.createElement(b,null,i.a.createElement(f,{size:"50px",direction:"left",title:"Save",disabled:"recording"!=n&&!r,onClick:function(){"recording"==n?(e.saveMode="saveNext",e.split()):r&&e.saveClip(r)}}),this.renderMainButton(),i.a.createElement(f,{size:"50px",direction:"right",title:"Skip",disabled:"recording"!=n&&!r,onClick:function(){"recording"==n?(e.saveMode="skipNext",e.split()):r&&e.setState({lastClip:void 0})}})))}}]),t}(a.Component),R=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return i.a.createElement(O,{title:"Session Recorder",screen:this.props.screen,onScreenChange:this.props.onScreenChange},i.a.createElement(C,{style:{height:"100px"}},i.a.createElement("input",{placeholder:"Enter a name your session...",onChange:function(t){e.props.onSessionNameChange(t.target.value)},type:"textfield",style:{maxWidth:"calc(100% - 20px)",height:"50px",flex:"auto",fontSize:"150%",padding:"0 10px",textAlign:"center"}})),i.a.createElement(b,null,i.a.createElement(v,{onClick:function(){e.props.onScreenChange("record")},title:"Start a new session"})))}}]),t}(a.Component),A=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement(O,{title:this.props.title,screen:this.props.screen,onScreenChange:this.props.onScreenChange},i.a.createElement(C,null,"Ooo, show all sessions and an option to create a new session"))}}]),t}(a.Component),M=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).setScreen=function(e){n.setState({currentScreen:e})},n.state={currentScreen:"start"},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;switch(this.state.currentScreen){case"record":return i.a.createElement(N,{screen:this.state.currentScreen,onScreenChange:this.setScreen,title:this.state.sessionName});case"listen":return i.a.createElement(A,{title:this.state.sessionName,screen:this.state.currentScreen,onScreenChange:this.setScreen});case"start":default:return i.a.createElement(R,{title:this.state.sessionName,screen:this.state.currentScreen,onScreenChange:this.setScreen,onSessionNameChange:function(t){e.setState({sessionName:t})}})}}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(i.a.createElement(M,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[10,1,2]]]);
//# sourceMappingURL=main.01d52f6d.chunk.js.map